/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => PokerRangePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  defaultRange: ""
};
var PokerRangePlugin = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.grid = new Grid("default", this.settings.defaultRange.split(","), (selectedCodes, id) => {
    });
    this.addSettingTab(new PokerRangeSettingTab(this.app, this));
    this.registerMarkdownCodeBlockProcessor("poker-range", (source, el, ctx) => {
      var _a;
      const lines = source.split("\n");
      let range = this.settings.defaultRange;
      let gridId = this.generateUniqueId();
      if (lines[0].startsWith("<!-- grid-id:")) {
        gridId = ((_a = lines[0].match(/<!-- grid-id:\s*(.+?)\s*-->/)) == null ? void 0 : _a[1]) || gridId;
        range = lines.slice(1).join(",").trim() || range;
      } else {
        range = source.trim() || range;
      }
      const grid = new Grid(gridId, range.split(","), (selectedCodes, id) => {
        this.updateCodeBlock(ctx, selectedCodes.join(","), id);
      });
      el.appendChild(grid.render());
    });
    this.addCommand({
      id: "insert-poker-range",
      name: "Insert Poker Range Table",
      editorCallback: (editor, view) => {
        const cursor = editor.getCursor();
        const range = this.settings.defaultRange;
        const gridId = this.generateUniqueId();
        const content = `\`\`\`poker-range
<!-- grid-id: ${gridId} -->
${range}
\`\`\`
`;
        editor.replaceRange(content, cursor);
        const endPos = editor.offsetToPos(editor.posToOffset(cursor) + content.length);
        editor.setCursor(endPos);
      }
    });
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  async updateCodeBlock(ctx, newRange, gridId) {
    const file = this.app.workspace.getActiveFile();
    if (!file)
      return;
    const content = await this.app.vault.read(file);
    const lines = content.split("\n");
    let inCodeBlock = false;
    let codeBlockStart = -1;
    let codeBlockEnd = -1;
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].trim().startsWith("```poker-range")) {
        inCodeBlock = true;
        codeBlockStart = i;
      } else if (inCodeBlock && lines[i].trim() === "```") {
        codeBlockEnd = i;
        const blockContent = lines.slice(codeBlockStart, codeBlockEnd + 1).join("\n");
        if (blockContent.includes(`<!-- grid-id: ${gridId} -->`)) {
          lines[codeBlockStart + 1] = `<!-- grid-id: ${gridId} -->`;
          lines[codeBlockStart + 2] = newRange;
          const updatedContent = lines.join("\n");
          await this.app.vault.modify(file, updatedContent);
          return;
        }
        inCodeBlock = false;
      }
    }
  }
  generateUniqueId() {
    return `grid-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
  }
};
var Grid = class {
  constructor(id, selectedCodes = [], onSelectionChange) {
    this.values = ["A", "K", "Q", "J", "T", "9", "8", "7", "6", "5", "4", "3", "2"];
    this.isSelecting = false;
    this.lastSelectedState = null;
    this.id = id;
    this.selectedCodes = new Set(selectedCodes);
    this.onSelectionChange = onSelectionChange;
  }
  render() {
    const grid = document.createElement("div");
    grid.className = "poker-range-grid";
    grid.setAttribute("data-grid-id", this.id);
    grid.addEventListener("mousedown", () => this.isSelecting = true);
    grid.addEventListener("mouseup", () => {
      this.isSelecting = false;
      this.lastSelectedState = null;
    });
    grid.addEventListener("mouseleave", () => {
      this.isSelecting = false;
      this.lastSelectedState = null;
    });
    for (let i = 0; i < 13; i++) {
      for (let j = 0; j < 13; j++) {
        const cell = document.createElement("div");
        cell.className = "poker-range-cell";
        cell.style.userSelect = "none";
        let content;
        if (i < j) {
          content = `${this.values[i]}${this.values[j]}s`;
          cell.classList.add("poker-range-suited");
        } else if (i > j) {
          content = `${this.values[j]}${this.values[i]}o`;
          cell.classList.add("poker-range-offsuit");
        } else {
          content = `${this.values[j]}${this.values[i]}`;
          cell.classList.add("poker-range-pair");
        }
        cell.textContent = content;
        if (this.selectedCodes.has(content)) {
          cell.classList.add("poker-range-selected");
        }
        cell.addEventListener("mousedown", (e) => this.handleCellInteraction(cell, content, e));
        cell.addEventListener("mouseover", (e) => this.handleCellInteraction(cell, content, e));
        grid.appendChild(cell);
      }
    }
    return grid;
  }
  handleCellInteraction(cell, content, event) {
    if (event.type === "mousedown" || event.type === "mouseover" && this.isSelecting) {
      if (this.lastSelectedState === null) {
        this.lastSelectedState = !this.selectedCodes.has(content);
      }
      this.toggleCell(cell, content, this.lastSelectedState);
    }
  }
  toggleCell(cell, content, forceState) {
    const newState = forceState !== void 0 ? forceState : !this.selectedCodes.has(content);
    if (newState) {
      this.selectedCodes.add(content);
      cell.classList.add("poker-range-selected");
    } else {
      this.selectedCodes.delete(content);
      cell.classList.remove("poker-range-selected");
    }
    this.onSelectionChange(Array.from(this.selectedCodes), this.id);
  }
  getSelectedCodes() {
    return Array.from(this.selectedCodes);
  }
  setSelectedCodes(codes) {
    this.selectedCodes = new Set(codes);
  }
};
var PokerRangeSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("Default Range").setDesc("Set the default poker range (comma-separated)").addText((text) => text.setPlaceholder("AKs,QJs").setValue(this.plugin.settings.defaultRange).onChange(async (value) => {
      this.plugin.settings.defaultRange = value;
      await this.plugin.saveSettings();
      this.updateGrid();
    }));
    this.gridContainer = containerEl.createDiv("poker-range-grid-container");
    this.updateGrid();
  }
  updateGrid() {
    this.gridContainer.empty();
    const grid = this.plugin.grid.render();
    this.gridContainer.appendChild(grid);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZywgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgRWRpdG9yLCBNYXJrZG93blZpZXcgfSBmcm9tICdvYnNpZGlhbic7XHJcblxyXG5pbnRlcmZhY2UgUG9rZXJSYW5nZVNldHRpbmdzIHtcclxuXHRkZWZhdWx0UmFuZ2U6IHN0cmluZztcclxufVxyXG5cclxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogUG9rZXJSYW5nZVNldHRpbmdzID0ge1xyXG5cdGRlZmF1bHRSYW5nZTogJydcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9rZXJSYW5nZVBsdWdpbiBleHRlbmRzIFBsdWdpbiB7XHJcblx0c2V0dGluZ3M6IFBva2VyUmFuZ2VTZXR0aW5ncztcclxuXHRncmlkOiBHcmlkO1xyXG5cclxuXHRhc3luYyBvbmxvYWQoKSB7XHJcblx0XHRhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG5cdFx0dGhpcy5ncmlkID0gbmV3IEdyaWQoJ2RlZmF1bHQnLCB0aGlzLnNldHRpbmdzLmRlZmF1bHRSYW5nZS5zcGxpdCgnLCcpLCAoc2VsZWN0ZWRDb2RlcywgaWQpID0+IHtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgUG9rZXJSYW5nZVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcclxuXHJcblx0XHR0aGlzLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IoJ3Bva2VyLXJhbmdlJywgKHNvdXJjZSwgZWwsIGN0eCkgPT4ge1xyXG5cdFx0XHRjb25zdCBsaW5lcyA9IHNvdXJjZS5zcGxpdCgnXFxuJyk7XHJcblx0XHRcdGxldCByYW5nZSA9IHRoaXMuc2V0dGluZ3MuZGVmYXVsdFJhbmdlO1xyXG5cdFx0XHRsZXQgZ3JpZElkID0gdGhpcy5nZW5lcmF0ZVVuaXF1ZUlkKCk7XHJcblxyXG5cdFx0XHRpZiAobGluZXNbMF0uc3RhcnRzV2l0aCgnPCEtLSBncmlkLWlkOicpKSB7XHJcblx0XHRcdFx0Z3JpZElkID0gbGluZXNbMF0ubWF0Y2goLzwhLS0gZ3JpZC1pZDpcXHMqKC4rPylcXHMqLS0+Lyk/LlsxXSB8fCBncmlkSWQ7XHJcblx0XHRcdFx0cmFuZ2UgPSBsaW5lcy5zbGljZSgxKS5qb2luKCcsJykudHJpbSgpIHx8IHJhbmdlO1xyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdHJhbmdlID0gc291cmNlLnRyaW0oKSB8fCByYW5nZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y29uc3QgZ3JpZCA9IG5ldyBHcmlkKGdyaWRJZCwgcmFuZ2Uuc3BsaXQoJywnKSwgKHNlbGVjdGVkQ29kZXMsIGlkKSA9PiB7XHJcblx0XHRcdFx0dGhpcy51cGRhdGVDb2RlQmxvY2soY3R4LCBzZWxlY3RlZENvZGVzLmpvaW4oJywnKSwgaWQpO1xyXG5cdFx0XHR9KTtcclxuXHRcdFx0ZWwuYXBwZW5kQ2hpbGQoZ3JpZC5yZW5kZXIoKSk7XHJcblx0XHR9KTtcclxuXHJcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xyXG5cdFx0XHRpZDogJ2luc2VydC1wb2tlci1yYW5nZScsXHJcblx0XHRcdG5hbWU6ICdJbnNlcnQgUG9rZXIgUmFuZ2UgVGFibGUnLFxyXG5cdFx0XHRlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcclxuXHRcdFx0XHRjb25zdCBjdXJzb3IgPSBlZGl0b3IuZ2V0Q3Vyc29yKCk7XHJcblx0XHRcdFx0Y29uc3QgcmFuZ2UgPSB0aGlzLnNldHRpbmdzLmRlZmF1bHRSYW5nZTtcclxuXHRcdFx0XHRjb25zdCBncmlkSWQgPSB0aGlzLmdlbmVyYXRlVW5pcXVlSWQoKTtcclxuXHRcdFx0XHRjb25zdCBjb250ZW50ID0gYFxcYFxcYFxcYHBva2VyLXJhbmdlXFxuPCEtLSBncmlkLWlkOiAke2dyaWRJZH0gLS0+XFxuJHtyYW5nZX1cXG5cXGBcXGBcXGBcXG5gO1xyXG5cdFx0XHRcdGVkaXRvci5yZXBsYWNlUmFuZ2UoY29udGVudCwgY3Vyc29yKTtcclxuXHJcblx0XHRcdFx0Y29uc3QgZW5kUG9zID0gZWRpdG9yLm9mZnNldFRvUG9zKGVkaXRvci5wb3NUb09mZnNldChjdXJzb3IpICsgY29udGVudC5sZW5ndGgpO1xyXG5cdFx0XHRcdGVkaXRvci5zZXRDdXJzb3IoZW5kUG9zKTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcclxuXHRcdGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XHJcblx0fVxyXG5cclxuXHRhc3luYyB1cGRhdGVDb2RlQmxvY2soY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0LCBuZXdSYW5nZTogc3RyaW5nLCBncmlkSWQ6IHN0cmluZykge1xyXG5cdFx0Y29uc3QgZmlsZSA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XHJcblx0XHRpZiAoIWZpbGUpIHJldHVybjtcclxuXHJcblx0XHRjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5hcHAudmF1bHQucmVhZChmaWxlKTtcclxuXHRcdGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XHJcblxyXG5cdFx0bGV0IGluQ29kZUJsb2NrID0gZmFsc2U7XHJcblx0XHRsZXQgY29kZUJsb2NrU3RhcnQgPSAtMTtcclxuXHRcdGxldCBjb2RlQmxvY2tFbmQgPSAtMTtcclxuXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGlmIChsaW5lc1tpXS50cmltKCkuc3RhcnRzV2l0aCgnYGBgcG9rZXItcmFuZ2UnKSkge1xyXG5cdFx0XHRcdGluQ29kZUJsb2NrID0gdHJ1ZTtcclxuXHRcdFx0XHRjb2RlQmxvY2tTdGFydCA9IGk7XHJcblx0XHRcdH0gZWxzZSBpZiAoaW5Db2RlQmxvY2sgJiYgbGluZXNbaV0udHJpbSgpID09PSAnYGBgJykge1xyXG5cdFx0XHRcdGNvZGVCbG9ja0VuZCA9IGk7XHJcblx0XHRcdFx0Y29uc3QgYmxvY2tDb250ZW50ID0gbGluZXMuc2xpY2UoY29kZUJsb2NrU3RhcnQsIGNvZGVCbG9ja0VuZCArIDEpLmpvaW4oJ1xcbicpO1xyXG5cdFx0XHRcdGlmIChibG9ja0NvbnRlbnQuaW5jbHVkZXMoYDwhLS0gZ3JpZC1pZDogJHtncmlkSWR9IC0tPmApKSB7XHJcblx0XHRcdFx0XHRsaW5lc1tjb2RlQmxvY2tTdGFydCArIDFdID0gYDwhLS0gZ3JpZC1pZDogJHtncmlkSWR9IC0tPmA7XHJcblx0XHRcdFx0XHRsaW5lc1tjb2RlQmxvY2tTdGFydCArIDJdID0gbmV3UmFuZ2U7XHJcblx0XHRcdFx0XHRjb25zdCB1cGRhdGVkQ29udGVudCA9IGxpbmVzLmpvaW4oJ1xcbicpO1xyXG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5hcHAudmF1bHQubW9kaWZ5KGZpbGUsIHVwZGF0ZWRDb250ZW50KTtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aW5Db2RlQmxvY2sgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdHByaXZhdGUgZ2VuZXJhdGVVbmlxdWVJZCgpOiBzdHJpbmcge1xyXG5cdFx0cmV0dXJuIGBncmlkLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIEdyaWQge1xyXG5cdHByaXZhdGUgaWQ6IHN0cmluZztcclxuXHRwcml2YXRlIHZhbHVlcyA9IFsnQScsICdLJywgJ1EnLCAnSicsICdUJywgJzknLCAnOCcsICc3JywgJzYnLCAnNScsICc0JywgJzMnLCAnMiddO1xyXG5cdHByaXZhdGUgc2VsZWN0ZWRDb2RlczogU2V0PHN0cmluZz47XHJcblx0cHJpdmF0ZSBvblNlbGVjdGlvbkNoYW5nZTogKHNlbGVjdGVkQ29kZXM6IHN0cmluZ1tdLCBpZDogc3RyaW5nKSA9PiB2b2lkO1xyXG5cdHByaXZhdGUgaXNTZWxlY3Rpbmc6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHRwcml2YXRlIGxhc3RTZWxlY3RlZFN0YXRlOiBib29sZWFuIHwgbnVsbCA9IG51bGw7XHJcblxyXG5cdGNvbnN0cnVjdG9yKGlkOiBzdHJpbmcsIHNlbGVjdGVkQ29kZXM6IHN0cmluZ1tdID0gW10sIG9uU2VsZWN0aW9uQ2hhbmdlOiAoc2VsZWN0ZWRDb2Rlczogc3RyaW5nW10sIGlkOiBzdHJpbmcpID0+IHZvaWQpIHtcclxuXHRcdHRoaXMuaWQgPSBpZDtcclxuXHRcdHRoaXMuc2VsZWN0ZWRDb2RlcyA9IG5ldyBTZXQoc2VsZWN0ZWRDb2Rlcyk7XHJcblx0XHR0aGlzLm9uU2VsZWN0aW9uQ2hhbmdlID0gb25TZWxlY3Rpb25DaGFuZ2U7XHJcblx0fVxyXG5cclxuXHRyZW5kZXIoKTogSFRNTEVsZW1lbnQge1xyXG5cdFx0Y29uc3QgZ3JpZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG5cdFx0Z3JpZC5jbGFzc05hbWUgPSAncG9rZXItcmFuZ2UtZ3JpZCc7XHJcblx0XHRncmlkLnNldEF0dHJpYnV0ZSgnZGF0YS1ncmlkLWlkJywgdGhpcy5pZCk7XHJcblxyXG5cdFx0Ly8gQWRkIG1vdXNlIGV2ZW50IGxpc3RlbmVycyB0byB0aGUgZ3JpZFxyXG5cdFx0Z3JpZC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoKSA9PiB0aGlzLmlzU2VsZWN0aW5nID0gdHJ1ZSk7XHJcblx0XHRncmlkLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoKSA9PiB7XHJcblx0XHRcdHRoaXMuaXNTZWxlY3RpbmcgPSBmYWxzZTtcclxuXHRcdFx0dGhpcy5sYXN0U2VsZWN0ZWRTdGF0ZSA9IG51bGw7XHJcblx0XHR9KTtcclxuXHRcdGdyaWQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHtcclxuXHRcdFx0dGhpcy5pc1NlbGVjdGluZyA9IGZhbHNlO1xyXG5cdFx0XHR0aGlzLmxhc3RTZWxlY3RlZFN0YXRlID0gbnVsbDtcclxuXHRcdH0pO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgMTM7IGkrKykge1xyXG5cdFx0XHRmb3IgKGxldCBqID0gMDsgaiA8IDEzOyBqKyspIHtcclxuXHRcdFx0XHRjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblx0XHRcdFx0Y2VsbC5jbGFzc05hbWUgPSAncG9rZXItcmFuZ2UtY2VsbCc7XHJcblx0XHRcdFx0Y2VsbC5zdHlsZS51c2VyU2VsZWN0ID0gJ25vbmUnO1xyXG5cdFx0XHRcdGxldCBjb250ZW50OiBzdHJpbmc7XHJcblx0XHRcdFx0aWYgKGkgPCBqKSB7XHJcblx0XHRcdFx0XHRjb250ZW50ID0gYCR7dGhpcy52YWx1ZXNbaV19JHt0aGlzLnZhbHVlc1tqXX1zYDtcclxuXHRcdFx0XHRcdGNlbGwuY2xhc3NMaXN0LmFkZCgncG9rZXItcmFuZ2Utc3VpdGVkJyk7XHJcblx0XHRcdFx0fSBlbHNlIGlmIChpID4gaikge1xyXG5cdFx0XHRcdFx0Y29udGVudCA9IGAke3RoaXMudmFsdWVzW2pdfSR7dGhpcy52YWx1ZXNbaV19b2A7XHJcblx0XHRcdFx0XHRjZWxsLmNsYXNzTGlzdC5hZGQoJ3Bva2VyLXJhbmdlLW9mZnN1aXQnKTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0Y29udGVudCA9IGAke3RoaXMudmFsdWVzW2pdfSR7dGhpcy52YWx1ZXNbaV19YDtcclxuXHRcdFx0XHRcdGNlbGwuY2xhc3NMaXN0LmFkZCgncG9rZXItcmFuZ2UtcGFpcicpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjZWxsLnRleHRDb250ZW50ID0gY29udGVudDtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMuc2VsZWN0ZWRDb2Rlcy5oYXMoY29udGVudCkpIHtcclxuXHRcdFx0XHRcdGNlbGwuY2xhc3NMaXN0LmFkZCgncG9rZXItcmFuZ2Utc2VsZWN0ZWQnKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIFJlcGxhY2UgY2xpY2sgZXZlbnQgd2l0aCBtb3VzZWRvd24gYW5kIG1vdXNlb3ZlclxyXG5cdFx0XHRcdGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpID0+IHRoaXMuaGFuZGxlQ2VsbEludGVyYWN0aW9uKGNlbGwsIGNvbnRlbnQsIGUpKTtcclxuXHRcdFx0XHRjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIChlKSA9PiB0aGlzLmhhbmRsZUNlbGxJbnRlcmFjdGlvbihjZWxsLCBjb250ZW50LCBlKSk7XHJcblxyXG5cdFx0XHRcdGdyaWQuYXBwZW5kQ2hpbGQoY2VsbCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZ3JpZDtcclxuXHR9XHJcblxyXG5cdHByaXZhdGUgaGFuZGxlQ2VsbEludGVyYWN0aW9uKGNlbGw6IEhUTUxFbGVtZW50LCBjb250ZW50OiBzdHJpbmcsIGV2ZW50OiBNb3VzZUV2ZW50KSB7XHJcblx0XHRpZiAoZXZlbnQudHlwZSA9PT0gJ21vdXNlZG93bicgfHwgKGV2ZW50LnR5cGUgPT09ICdtb3VzZW92ZXInICYmIHRoaXMuaXNTZWxlY3RpbmcpKSB7XHJcblx0XHRcdGlmICh0aGlzLmxhc3RTZWxlY3RlZFN0YXRlID09PSBudWxsKSB7XHJcblx0XHRcdFx0dGhpcy5sYXN0U2VsZWN0ZWRTdGF0ZSA9ICF0aGlzLnNlbGVjdGVkQ29kZXMuaGFzKGNvbnRlbnQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMudG9nZ2xlQ2VsbChjZWxsLCBjb250ZW50LCB0aGlzLmxhc3RTZWxlY3RlZFN0YXRlKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHByaXZhdGUgdG9nZ2xlQ2VsbChjZWxsOiBIVE1MRWxlbWVudCwgY29udGVudDogc3RyaW5nLCBmb3JjZVN0YXRlPzogYm9vbGVhbikge1xyXG5cdFx0Y29uc3QgbmV3U3RhdGUgPSBmb3JjZVN0YXRlICE9PSB1bmRlZmluZWQgPyBmb3JjZVN0YXRlIDogIXRoaXMuc2VsZWN0ZWRDb2Rlcy5oYXMoY29udGVudCk7XHJcblx0XHRpZiAobmV3U3RhdGUpIHtcclxuXHRcdFx0dGhpcy5zZWxlY3RlZENvZGVzLmFkZChjb250ZW50KTtcclxuXHRcdFx0Y2VsbC5jbGFzc0xpc3QuYWRkKCdwb2tlci1yYW5nZS1zZWxlY3RlZCcpO1xyXG5cdFx0fSBlbHNlIHtcclxuXHRcdFx0dGhpcy5zZWxlY3RlZENvZGVzLmRlbGV0ZShjb250ZW50KTtcclxuXHRcdFx0Y2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdwb2tlci1yYW5nZS1zZWxlY3RlZCcpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5vblNlbGVjdGlvbkNoYW5nZShBcnJheS5mcm9tKHRoaXMuc2VsZWN0ZWRDb2RlcyksIHRoaXMuaWQpO1xyXG5cdH1cclxuXHJcblx0Z2V0U2VsZWN0ZWRDb2RlcygpOiBzdHJpbmdbXSB7XHJcblx0XHRyZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnNlbGVjdGVkQ29kZXMpO1xyXG5cdH1cclxuXHJcblx0c2V0U2VsZWN0ZWRDb2Rlcyhjb2Rlczogc3RyaW5nW10pIHtcclxuXHRcdHRoaXMuc2VsZWN0ZWRDb2RlcyA9IG5ldyBTZXQoY29kZXMpO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgUG9rZXJSYW5nZVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuXHRwbHVnaW46IFBva2VyUmFuZ2VQbHVnaW47XHJcblx0Z3JpZENvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcblxyXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFBva2VyUmFuZ2VQbHVnaW4pIHtcclxuXHRcdHN1cGVyKGFwcCwgcGx1Z2luKTtcclxuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xyXG5cdH1cclxuXHJcblx0ZGlzcGxheSgpOiB2b2lkIHtcclxuXHRcdGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XHJcblx0XHRjb250YWluZXJFbC5lbXB0eSgpO1xyXG5cclxuXHRcdG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxyXG5cdFx0XHQuc2V0TmFtZSgnRGVmYXVsdCBSYW5nZScpXHJcblx0XHRcdC5zZXREZXNjKCdTZXQgdGhlIGRlZmF1bHQgcG9rZXIgcmFuZ2UgKGNvbW1hLXNlcGFyYXRlZCknKVxyXG5cdFx0XHQuYWRkVGV4dCh0ZXh0ID0+IHRleHRcclxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJ0FLcyxRSnMnKVxyXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWZhdWx0UmFuZ2UpXHJcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xyXG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVmYXVsdFJhbmdlID0gdmFsdWU7XHJcblx0XHRcdFx0XHRhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcclxuXHRcdFx0XHRcdHRoaXMudXBkYXRlR3JpZCgpO1xyXG5cdFx0XHRcdH0pKTtcclxuXHJcblx0XHR0aGlzLmdyaWRDb250YWluZXIgPSBjb250YWluZXJFbC5jcmVhdGVEaXYoJ3Bva2VyLXJhbmdlLWdyaWQtY29udGFpbmVyJyk7XHJcblx0XHR0aGlzLnVwZGF0ZUdyaWQoKTtcclxuXHR9XHJcblxyXG5cdHVwZGF0ZUdyaWQoKSB7XHJcblx0XHR0aGlzLmdyaWRDb250YWluZXIuZW1wdHkoKTtcclxuXHRcdGNvbnN0IGdyaWQgPSB0aGlzLnBsdWdpbi5ncmlkLnJlbmRlcigpO1xyXG5cdFx0dGhpcy5n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
